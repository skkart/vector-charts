<!DOCTYPE html>
<meta charset="utf-8">
<style>
    body {
        font-family: 'Roboto';
        /* font-family: RobotoLight; */
        font-weight: 300;
        font-size: 12px;
        /* font: normal 13px Calibri; */
        color: #363636;
    }
</style>

<body>
    <h1 style="padding-bottom:50px;"> </h1>
    <br/><br/>
    <div id="container" style="width: 70%;"><svg>

    </svg></div>
    <br/><br/>
    <br/><br/>
    <br/><br/>
    <div id="container2" style="width: 70%;"> <svg>

    </svg></div>
    <br/><br/>
    <br/><br/>
    <br/><br/>
    <div id="container3" style="width: 70%;" ><svg>

    </svg></div>
    <br/><br/>
    <br/><br/>
    <br/><br/>
</body>
<link rel="stylesheet" type="text/css" href="AryakaCharts.css">
<script src="jquery-1.8.2.min.js"></script>
<script src="underscore-min.js"></script>
<script src="backbone-min.js"></script>
<script src="date.js"></script>
<script src="d3.v4.min.js"></script>
<script>
// Define user timezone, So that the GMT time in response is converted to usertimezone to show in charts
Variables = {
    userCustomizeInfo : {
        timeZone: "Asia/Kolkata"
    }
};

// Load timezoneJS which is used for date convertion to user time zone
timezoneJS.timezone.zoneFileBasePath = '/tz';
timezoneJS.timezone.init();
</script>

<script src="AryakaCharts.js"></script> 
<script src="AryakaChartsExt.js"></script>
<script>
    var myChart = [];
    /*
    AryakaCharts.js is d3 based charting library which plots graphs based on option supplied to it.
    
    AryakaChartsExt.js is library which interact with AryakaCharts and MyAryaka Ui, creates chartOptions, generates dataparser, formatters, event handling, dataPromises etc which are more specific to MyAryaka project.

    Currently supported json types for timeseries graphs are of two types timeSeriesDataType1 and timeSeriesDataType2. Both the usage are expained below.

    AryakaCharts supports charts of two types -> timeseries and pieseries.
    Timeseries charts can show two series -> line, stack

    */
    d3.json("trafficLarge.json", function(error, jdata) {
        if (error) throw error;
        /*
        This chart shows single yAxis with combination of line and stack series. json_type - timeSeriesDataType1
        timeSeriesDataType1 data parser is defined in AryakaChartsExt which abides to the rules of ac.chartAxisDataProcessor
        The format of timeSeriesDataType1 is as shown below:
       "ResJSON": {
              "timeseries":{
                 "unit":[
                    "secs",
                    "bps",
                    "bps",
                    "bps"
                 ],
                 "columns":[
                    "timestamp",
                    "s1",
                    "s2"
                 ],
                 "values":[
                    [time_val, s1_val, s2_val]
                 ]
              },
              "startTime":t1, // epoc
              "endTime":t2, // epoc
              "constantSeries":{
                 "c1":{
                    "unit":"bps",
                    "value":1.0E8
                 },
                 "c2":{
                    "unit":"bps",
                    "value":1.0E8
                 },
                 "columns":[
                    "c1",
                    "c2"
                 ]
              },
              "token":true
           }
        */
        var opts = {
            chart: {
                chartType: 'timeseries', // Define chartType, Can take timeseries/pieseries
                heading: "LAN Traffic - All Application(s)",
                height: 270, // Mention chart height
                //width: 800, //Mention chart width if need fixed width or else It takes continer width
                margin: {
                    top: 40,
                    right: 15,
                    bottom: 50,
                    left: 15
                },
                chartResize: true // Flag to make chart responsive
            },
            data: jdata.ResJSON, // Supply response of type timeSeriesDataType1
            xAxis: {
                timeZoneStr: ' GMT+5:30', // used to display usertime zone in tooltip
                bottom: {
                    unit: 'sec', // unit must be 'sec' for timeseries chart
                    label: 'time', // Label to be displayed below xAxis tick,
                    // tickFormatter : function(){} Define formatter, Default timeseries formatter is added for xAxis in optionsPreProcessor() of AryakaChartsExt

                }
            },
            yAxis: {
                left: {
                    unit: 'bps', // unit is 'bps', its respective formatter is defined in formatter of AryakaChartsExt
                    tickNumber: 5, // Specify max ticks to display alone YAxis
                    // tickFormatter : function(){} Define formatter
                }
            },
            /*
            series defines different charts to be shown for the obatained json type. Below usage shows combination of line and stack graph.
            The name of every series must match with the names defined in timeseries.columns[] of response
            */
            series: {
                line: [{
                    name: 'Total', // Name taken from timeseries.columns
                    lineWidth: '2px',
                    plotAxis: ["left", "bottom"], // Define its axis dependency
                    color:"#386CB0" // Specify series color
                }],
                stack: [{
                    name: 'StackGroup', // Name of stack
                    plotAxis: ["left", "bottom"], // Define its axis dependency for all below defined series
                    stackOrderMembers: [{
                            name: 'Accelerated', // Name taken from timeseries.columns
                            color:"#339966"
                        },
                        {
                            name: 'Pass-Through', // Name taken from timeseries.columns
                            color:"#85FF85"

                        }
                    ]
                }]
            },
            /*
            constantSeries are line series charts
            The name of every series must match with the names defined in constantSeries.columns[] of response
            */
            constantSeries: {
                line: [{
                        name: 'Subscribed Bandwidth', // Name taken from constantSeries.columns
                        lineWidth: '2px',
                        plotAxis: ["left", "bottom"], // Define its axis dependency
                        color:"#666699"
                    },
                    {
                        name: 'Link Size', // Name taken from constantSeries.columns
                        lineWidth: '2px',
                        plotAxis: ["left", "bottom"], // Define its axis dependency
                        color:"#4f56fd"
                    }
                ]
            },
            tooltip: {
                visible: true,
                // format: function() {} Define formatter, Default timeseries formatter is added for tooltip in optionsPreProcessor() of AryakaChartsExt
            },
            legend: {
                visible: true,
                legendPrefix: '', // Append prefix for all lengends ,
                onLegendChange: function(seriesObj, isVisible) {
                    // Context --> ChartInstance
                    // seriesObj -- seriesInfo on which its clicked, isVisible
                }
            },
            /*
            For timeseries, If zoom is enabled. onZoom fn will be triggered on user zoom. 
            */
            zoom: {
                visible: true,
                onY1Zoom: function(y1, y2) {
                // Context --> ChartInstance
                // y1, y2 are y axis range of the on yZoom
                },
                onZoom: function(d1, d2) {
                    // Context --> ChartInstance
                    // d1, d2 are date range of the zoom
                    var self = this;
                    d3.json("traffic2.json", function(error, jdata) {
                        if (error) {
                            throw error;
                        }

                        opts.data = jdata.ResJSON;
                        AryakaChartsExt.refreshChart(self, opts, function() {
                            console.log('Refresh Done');
                        });
                    });
                }
            }
        };

        myChart.push(AryakaChartsExt.createChart("#container", opts));


    });

    
    d3.json("arrJSON.json", function(error, jdata) {
        if (error) throw error;
        /*
        This chart shows dual yAxis usage with multi line series. json_type - timeSeriesDataType1
        */
        var opts2 = {
            chart: {
                chartType: 'timeseries',
                heading: "Compression (ARR)",
                chartIndex: 2,
                //width: 800,
                height: 270,
                margin: {
                    top: 40,
                    right: 15,
                    bottom: 50,
                    left: 15
                },
                chartResize: true
            },
            data: jdata.ResJSON,
            xAxis: {
                timeZoneStr: ' GMT+5:30',
                bottom: {
                    unit: AryakaCharts.constants.UNITS_SECONDS,
                }
            },
            yAxis: {
                right: {
                    unit: '%',
                    tickNumber: 5,
                    min: 0
                },
                left: {
                    unit: 'bps',
                    tickNumber: 5
                }
            },
            series: {
                line: [{
                        name: 'Post Compressed Traffic',
                        color:"#386CB0",
                        lineWidth: '2px',
                        plotAxis: ["left", "bottom"]
                    }, {
                        name: 'Pre Compressed Traffic',
                        color:"#666699",
                        lineWidth: '2px',
                        plotAxis: ["left", "bottom"]
                    }, {
                        name: 'Bandwidth Saved',
                        color:"#368669",
                        lineWidth: '2px',
                        plotAxis: ["left", "bottom"]
                    },
                    {
                        name: 'Data Reduction(%)',
                        color:"#fff099",
                        lineWidth: '2px',
                        plotAxis: ["right", "bottom"]

                    }
                ],
                stack: []
            }
        };

        myChart.push(AryakaChartsExt.createChart("#container2", opts2));

    });


    d3.json("topApps.json", function(error, jdata) {
        if (error) throw error;

        /*
        This chart shows usage of stack series for all columns. json_type - timeSeriesDataType2
        timeSeriesDataType2 data parser is defined in AryakaChartsExt which abides to the rules of ac.chartAxisDataProcessor
        The format of timeSeriesDataType2 can be parsed from topApps.json response
        */

        var opts3 = {
            chart: {
                chartType: 'timeseries',
                heading: "Top Apps (In)",
                chartIndex: 3,
                className: 'all_apps',
                width: 800,
                height: 250,
                margin: {
                    top: 40,
                    right: 15,
                    bottom: 50,
                    left: 15
                },
                chartResize: true
            },
            data: jdata.ResJSON,
            xAxis: {
                timeZoneStr: ' GMT+5:30',
                bottom: {
                    unit: AryakaCharts.constants.UNITS_SECONDS,
                    tickFormatter: false,
                    label: 'time'
                }
            },
            yAxis: {
                left: {
                    unit: 'bps',
                    tickNumber: 5
                }
            },
            series: {
                line: [],
                stack: [{
                    name: 'StackGroup_Apps',
                    plotAxis: ["left", "bottom"],
                    stackOrderMembers: [
                        // The stack for each series will be drawn alone yAxis in same order as defined below.
                        {
                            name: 'CIFS',
                            color:"#386CB0",
                        },
                        {
                            name: 'HTTP',
                            color:"#98376F",
                        }, {
                            name: 'HTTPS',
                            color:"#654786",
                        },
                        {
                            name: 'ALL UDP',
                            color:"#F84573",
                        },
                        {
                            name: 'Others',
                            color:"#fff099",
                        }

                    ]
                }]
            }

        };

        myChart.push(AryakaChartsExt.createChart("#container3", opts3));

    });

</script>
